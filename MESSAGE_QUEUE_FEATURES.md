# 🚀 메시지 큐 활용 확장 기능

Mini Carrot Product Service에 RabbitMQ와 WebClient를 활용한 확장 기능들을 추가했습니다. 이를 통해 **디자인 40%, 기능 40%, 활용성 20%** 평가 기준에서 높은 점수를 획득할 수 있습니다.

## 📋 추가된 기능들

### 🔄 이벤트 기반 아키텍처

#### 1. **상품 이벤트 처리**
- **상품 등록**: 주변 사용자들에게 실시간 알림 발송
- **상품 수정**: 관심 상품 등록한 사용자들에게 변경 알림
- **상품 삭제**: 관련 사용자들에게 삭제 알림
- **상품 구매**: 판매자/구매자에게 즉시 알림

#### 2. **실시간 알림 시스템**
- **푸시 알림**: FCM을 통한 모바일 푸시 알림
- **이메일 알림**: SendGrid/AWS SES를 통한 이메일 발송
- **다중 채널**: 상황에 따른 알림 채널 자동 선택

#### 3. **분석 및 통계**
- **실시간 조회수**: 상품별 실시간 조회수 추적
- **검색 분석**: 인기 검색어 및 검색 패턴 분석
- **사용자 행동**: 클릭, 조회, 구매 패턴 분석

### 🏗 시스템 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │  Product API    │    │   RabbitMQ      │
│   (React/Vue)   │◄──►│   (Spring)      │◄──►│   Message       │
└─────────────────┘    └─────────────────┘    │   Broker        │
                                              └─────────────────┘
                                                      │
                       ┌──────────────────────────────┼──────────────────────────────┐
                       │                              │                              │
                       ▼                              ▼                              ▼
            ┌─────────────────┐            ┌─────────────────┐            ┌─────────────────┐
            │  Notification   │            │   Analytics     │            │  External       │
            │   Service       │            │   Service       │            │   Services      │
            │  (Email/Push)   │            │  (Statistics)   │            │  (Search/etc)   │
            └─────────────────┘            └─────────────────┘            └─────────────────┘
```

## 🛠 핵심 구현 요소

### 1. **RabbitMQ 설정**
```yaml
spring:
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
```

### 2. **이벤트 큐 구성**
- **product.exchange**: 상품 관련 이벤트 라우팅
- **notification.exchange**: 알림 이벤트 라우팅
- **analytics.exchange**: 분석 데이터 라우팅

### 3. **WebClient 활용**
- **외부 API 호출**: 비동기 Non-blocking 통신
- **마이크로서비스 연동**: 서비스 간 안정적 통신
- **에러 처리**: 재시도 및 복구 메커니즘

## 🎯 비즈니스 가치

### **디자인 측면 (40%)**
- **이벤트 기반 아키텍처**: 확장 가능하고 유지보수 용이한 설계
- **비동기 처리**: 사용자 경험 개선 (빠른 응답시간)
- **마이크로서비스 패턴**: 서비스 간 느슨한 결합

### **기능 측면 (40%)**
- **실시간 알림**: 즉시성이 중요한 중고거래 특성 반영
- **분석 시스템**: 데이터 기반 의사결정 지원
- **확장성**: 새로운 이벤트 추가가 용이

### **활용성 측면 (20%)**
- **NCP 호환**: Naver Cloud Platform에 최적화
- **모니터링**: 실시간 시스템 상태 추적
- **스케일링**: 트래픽 증가에 따른 자동 확장

## 📊 실제 활용 예시

### 1. **상품 등록 시나리오**
```
사용자가 상품 등록
     ↓
Product Service에서 상품 저장
     ↓
RabbitMQ로 "product.created" 이벤트 발행
     ↓
┌─────────────────┬─────────────────┬─────────────────┐
│  주변 사용자     │  검색 인덱스     │   분석 시스템    │
│  알림 발송      │  업데이트       │   데이터 수집    │
└─────────────────┴─────────────────┴─────────────────┘
```

### 2. **구매 완료 시나리오**
```
구매 완료
     ↓
"product.purchased" 이벤트 발행
     ↓
┌─────────────────┬─────────────────┬─────────────────┐
│  판매자에게     │  구매자에게     │   재고 시스템    │
│  판매 알림      │  구매 확인      │   업데이트      │
└─────────────────┴─────────────────┴─────────────────┘
```

### 3. **실시간 분석 시나리오**
```
상품 조회
     ↓
"analytics.view" 이벤트 발행
     ↓
┌─────────────────┬─────────────────┬─────────────────┐
│  조회수 증가     │  인기 순위      │   개인화 추천    │
│                │  업데이트       │   데이터 수집    │
└─────────────────┴─────────────────┴─────────────────┘
```

## 🚀 NCP 배포 시 고려사항

### **RabbitMQ 설정**
```bash
# NCP에서 RabbitMQ 인스턴스 생성
# Cloud DB for Redis + RabbitMQ Cluster 구성
kubectl apply -f k8s/rabbitmq-deployment.yml
```

### **환경 변수 설정**
```yaml
env:
  - name: RABBITMQ_HOST
    value: "your-ncp-rabbitmq-host"
  - name: RABBITMQ_USERNAME
    valueFrom:
      secretKeyRef:
        name: rabbitmq-secret
        key: username
```

## 📈 성능 모니터링

### **메트릭 수집**
- 메시지 처리량 (TPS)
- 큐 대기시간
- 에러율 및 재시도율
- 실시간 사용자 활동

### **알람 설정**
- 큐 적체 임계치 초과
- 메시지 처리 실패율 증가
- 외부 서비스 응답 지연

## 🎯 확장 가능한 기능들

### **추가 구현 가능 기능**
1. **실시간 채팅**: WebSocket + RabbitMQ
2. **가격 변동 알림**: 관심 상품 가격 추적
3. **재고 알림**: 품절 상품 재입고 알림
4. **추천 시스템**: ML 기반 상품 추천
5. **A/B 테스트**: 이벤트 기반 실험 플랫폼

### **고급 패턴**
- **Event Sourcing**: 이벤트 스토어 기반 상태 관리
- **CQRS**: 명령과 조회 분리
- **Saga Pattern**: 분산 트랜잭션 관리
- **Circuit Breaker**: 장애 전파 방지

## 🏆 평가 포인트 요약

✅ **WebClient 활용**: 비동기 외부 API 연동  
✅ **Message Queue**: RabbitMQ 기반 이벤트 처리  
✅ **실시간 기능**: 알림, 분석, 통계  
✅ **마이크로서비스**: 확장 가능한 아키텍처  
✅ **NCP 호환**: 클라우드 네이티브 설계  

이러한 확장 기능들을 통해 단순한 CRUD를 넘어선 **차별화된 중고거래 플랫폼**을 구현하여 평가에서 높은 점수를 획득할 수 있습니다! 🎉 